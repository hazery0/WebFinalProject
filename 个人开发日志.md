# 个人开发日志

## 2025-12-14

### 后端开发

#### 1. 项目初始化与依赖配置
- 创建了Spring Boot 3项目
- 添加了JWT和密码加密依赖
- 配置了MySQL数据库连接

#### 2. 核心代码开发
- 创建了`User`实体类，包含id、username、password、isAdmin字段
- 实现了`UserRepository`接口，用于数据库操作
- 创建了`JwtUtil`工具类，用于生成和验证JWT令牌
- 创建了`PasswordEncoderUtil`工具类，使用BCrypt加密密码

#### 3. 控制器开发
- 实现了`AuthController`，包含：
  - 注册接口：`POST /api/auth/register`
  - 登录接口：`POST /api/auth/login`
- 配置了CORS，允许前端跨域请求

#### 4. 安全配置
- 实现了`SecurityConfig`，配置了：
  - JWT认证
  - 权限控制
  - CORS配置
  - 允许匿名访问的端点

### 前端开发

#### 1. 项目初始化
- 检查了前端项目结构
- 安装了axios依赖

#### 2. API服务封装
- 创建了`api.ts`，配置了axios实例
- 实现了请求拦截器和响应拦截器
- 封装了认证相关API

## 2025-12-15

### 后端开发

#### 1. 健康检查端点
- 添加了`HealthController`，提供`/api/health`端点
- 用于前端测试后端连接

#### 2. 配置更新
- 更新了CORS配置，将允许的源地址从5174改为5173
- 更新了安全配置，允许`/api/health`匿名访问

### 前端开发

#### 1. 清理与重构
- 清理了现有代码，保留核心文件
- 简化了`App.vue`和`main.ts`
- 配置了基础路由

#### 2. 登录注册组件
- 创建了`LoginView.vue`登录组件：
  - 用户名密码输入
  - 登录逻辑实现
  - 错误处理
  - 注册链接

- 创建了`RegisterView.vue`注册组件：
  - 用户名密码输入
  - 注册逻辑实现
  - 表单验证
  - 登录链接

#### 3. 路由配置
- 更新了路由配置，添加了登录和注册路由
- 将根路径`/`重定向到`/login`
- 保留`/home`作为登录后的首页

#### 4. API服务更新
- 添加了登录和注册请求方法
- 配置了请求拦截器，自动携带JWT令牌

## 2025-12-16

### 后端开发

#### 1. API扩展
- 添加了批量导入历史人物的API端点`POST /api/historical-persons/batch`
- 添加了更新历史人物的API端点`PUT /api/historical-persons/{id}`
- 扩展了`HistoricalPersonService`，添加了`batchAddHistoricalPersons`方法

#### 2. 数据库操作优化
- 使用JPA的`saveAll`方法实现高效批量插入
- 利用save方法的特性，根据ID判断是新增还是更新

### 前端开发

#### 1. 管理员功能
- 实现了历史人物的编辑功能，采用悬浮窗形式
- 添加了批量导入功能，支持JSON文件导入
- 实现了完整的分页功能，包括：
  - 上一页/下一页导航
  - 每页显示数量调整
  - 页码跳转
  - 记录范围显示

#### 2. 编辑悬浮窗
- 将编辑表单改为悬浮窗模态框
- 点击遮罩层或关闭按钮可关闭
- 支持键盘ESC关闭
- 表单居中显示，提升用户体验

#### 3. 分页功能
- 实现了前端分页逻辑，支持大数据量展示
- 实时更新分页状态和记录范围
- 调整每页显示数量后自动重置到第一页

#### 4. 样式优化
- 统一了表单样式
- 优化了模态框设计
- 添加了动画效果
- 响应式布局适配

### 其他工作

#### 1. 文件处理
- 尝试修复`2.json`文件的乱码问题
- 编写了编码转换脚本

#### 2. 功能测试
- 测试了编辑悬浮窗功能
- 验证了分页功能
- 测试了批量导入功能

#### 3. 代码优化
- 统一了组件命名规范
- 优化了状态管理
- 改进了错误处理

## 遇到的问题及解决方案

### 后端问题

1. **JWT工具类API更新问题**
   - 问题：JJWT 0.12.x版本API变化，导致`parseClaimsJws`方法调用失败
   - 解决方案：更新JWT工具类，使用新的API格式

2. **CORS配置问题**
   - 问题：前端端口变化，导致跨域请求失败
   - 解决方案：更新后端CORS配置，匹配前端实际端口

### 前端问题

1. **路由重定向循环**
   - 问题：登录成功后跳转到`/`，但`/`已重定向到`/login`，导致无限循环
   - 解决方案：将登录成功跳转路径改为`/home`

2. **vue-router导入错误**
   - 问题：`RouteRecordRaw`不再作为命名导出提供
   - 解决方案：移除类型导入，使用隐式类型推断

3. **浏览器扩展错误**
   - 问题：CSS Peeper扩展导致控制台报错
   - 解决方案：确认不是应用代码问题，建议更新或禁用扩展

## 项目状态

### 后端
- 核心功能已实现
- 登录注册接口正常
- 健康检查端点正常
- CORS和Security配置正确

### 前端
- 登录注册界面已实现
- 路由配置完成
- API服务已配置
- 能正常与后端通信

### 前后端联调
- 已完成基础联调
- 登录注册功能正常
- JWT令牌能正常生成和验证
- 跨域请求正常

## 后续计划

1. 完善首页功能
2. 添加更多业务功能
3. 优化用户体验
4. 添加更完善的错误处理
5. 实现用户信息管理

## 技术栈

### 后端
- Spring Boot 3
- Spring Data JPA
- MySQL
- JWT
- Spring Security
- BCrypt密码加密

### 前端
- Vue 3
- TypeScript
- Vue Router
- Axios
- Vite

## 访问地址

- 前端：http://localhost:5173
- 后端API：http://localhost:8080/api
- 登录页面：http://localhost:5173/login
- 注册页面：http://localhost:5173/register
- 首页：http://localhost:5173/home



## 12.19

### 前端开发

#### 页面开发

- 创建选择游戏模式页面
- 创建选择创建房间或者加入房间页面
- 创建多人游戏模式



#### 路由开发

- 修改路由以匹配页面跳转逻辑

## 2025-12-22

### 后端开发

#### 1. WebSocket功能修复与完善

- 修复了WebSocket连接配置
- 优化了`GameRoomService`的房间管理逻辑
- 添加了房间创建时的房间号生成功能
- 实现了房间加入的验证逻辑
- 添加了房间状态同步机制

#### 2. 游戏核心功能开发

- 完善了`startGame`方法，初始化玩家状态
- 添加了`endGame`方法，处理游戏结束逻辑
- 实现了`incrementGuessCount`方法，记录玩家猜测次数
- 添加了`checkGameEnd`方法，检查游戏结束条件

### 前端开发

#### 1. WebSocket连接修复

- 修复了前端WebSocket服务的连接配置
- 优化了`gameService.ts`的消息处理逻辑
- 添加了连接状态管理
- 实现了自动重连机制

#### 2. 房间创建与加入功能完善

- 优化了房间创建流程
- 添加了房间加入的错误处理
- 实现了房间状态的实时更新
- 完善了UI界面显示

## 2025-12-23

### 后端开发

#### 1. 多人猜谜功能实现

- 实现了`handleGuess`方法，处理玩家猜测
- 添加了猜测结果的比较逻辑
- 实现了提示信息生成算法
- 添加了猜测次数限制
- 实现了玩家投降功能

#### 2. 游戏结束条件完善

- 实现了多种游戏结束条件：
  - 玩家猜对答案
  - 所有玩家投降
  - 所有玩家猜测次数用尽
- 添加了游戏结束时的结果广播

### 前端开发

#### 1. 多人猜谜界面实现

- 完善了`MultiModeGame.vue`组件
- 添加了猜测次数显示
- 实现了投降按钮功能
- 添加了游戏结束界面
- 实现了猜测历史记录

#### 2. 游戏交互优化

- 优化了搜索功能
- 添加了猜测结果的实时反馈
- 实现了聊天室功能
- 完善了玩家列表显示

### 测试与调试

- 测试了WebSocket连接的稳定性
- 验证了房间创建和加入功能
- 测试了多人猜谜流程
- 验证了游戏结束条件
- 调试了各种边界情况

## 技术亮点

1. **实时通信机制**：使用WebSocket实现了低延迟的实时通信，确保玩家之间的猜测和聊天信息能够及时传递

2. **灵活的游戏规则**：支持多种游戏结束条件，包括猜对答案、玩家投降和猜测次数用尽

3. **完善的状态管理**：实现了房间状态、玩家状态和游戏状态的统一管理，确保数据一致性

4. **友好的用户界面**：设计了直观的游戏界面，包括猜测次数显示、投降按钮、历史记录和聊天室

5. **良好的错误处理**：添加了完善的错误处理机制，包括WebSocket连接错误、房间加入失败、猜测次数用尽等情况

## 项目状态

### 后端

- WebSocket功能已修复并完善
- 房间管理功能正常
- 多人猜谜逻辑已实现
- 游戏结束条件已完善

### 前端

- 游戏模式选择页面已实现
- 房间创建和加入功能正常
- 多人游戏界面已完成
- WebSocket连接稳定

### 前后端联调

- WebSocket通信正常
- 房间状态同步良好
- 猜测结果实时反馈
- 游戏结束逻辑正确

## 后续计划

1. 优化游戏体验，添加更多交互效果
2. 完善聊天室功能，添加表情和图片支持
3. 实现玩家积分系统
4. 添加游戏历史记录功能
5. 优化移动端适配
6. 添加更多历史人物数据
7. 实现排行榜功能
8. 添加好友系统

## 遇到的问题及解决方案

### 后端问题

1. **WebSocket连接配置问题**
   - 问题：WebSocket连接失败，无法建立实时通信
   - 解决方案：检查并修复了WebSocket配置，确保正确的端点和消息映射

2. **房间状态同步问题**
   - 问题：玩家加入房间后，其他玩家的玩家列表没有实时更新
   - 解决方案：添加了房间状态的广播机制，确保所有玩家看到的房间状态一致

### 前端问题

1. **WebSocket消息处理问题**
   - 问题：前端无法正确处理后端发送的消息
   - 解决方案：优化了消息处理逻辑，添加了消息类型的判断和处理

2. **游戏状态管理问题**
   - 问题：游戏状态切换时，UI没有及时更新
   - 解决方案：使用Vue的响应式系统，确保状态变化时UI自动更新

## 技术栈

### 后端

- Spring Boot 3
- Spring Data JPA
- MySQL
- JWT
- Spring Security
- Spring WebSocket
- BCrypt密码加密

### 前端

- Vue 3
- TypeScript
- Vue Router
- Axios
- WebSocket API
- Vite

## 访问地址

- 前端：http://localhost:5173
- 后端API：http://localhost:8080/api
- 游戏页面：http://localhost:5173/multi-mode-game 

## 2025-12-28

### 部署配置

#### 1. 前端配置优化

- 修改了`LoginView.vue`中的API调用地址，将硬编码的`http://localhost:8080/api/auth/login`改为相对路径`/api/auth/login`
- 修改了`RegisterView.vue`中的API调用地址，将硬编码的`http://localhost:8080/api/auth/register`改为相对路径`/api/auth/register`
- 重新构建了前端项目，生成了新的静态文件

#### 2. Nginx配置

- 创建了`nginx.conf.example`配置文件，包含：
  - 前端静态资源服务配置
  - API代理配置（`/api`路径代理到后端）
  - WebSocket代理配置（`/ws-game`路径）
  - 静态资源缓存配置
  - 安全配置（禁止访问隐藏文件）

#### 3. 后端服务配置

- 创建了`backend.service.example`systemd服务配置文件，包含：
  - 服务描述和依赖关系
  - 服务用户和工作目录配置
  - 启动命令和重启策略
  - 环境变量配置（JVM参数、Spring环境）
  - 日志配置

#### 4. 部署脚本编写

- 编写了完整的部署命令序列，包括：
  - 创建必要的目录结构
  - 复制文件到正确位置
  - 配置Nginx
  - 配置并启动后端服务
  - 检查服务状态
  - 验证部署

### 遇到的问题及解决方案

#### 1. CORS跨域问题

- 问题：前端直接请求`http://localhost:8080`导致CORS错误
- 解决方案：将前端API调用地址改为相对路径，通过Nginx代理访问后端

#### 2. Nginx配置问题

- 问题：Nginx无法找到前端静态文件，返回404错误
- 解决方案：修改Nginx配置文件中的根目录，确保指向正确的前端文件位置

#### 3. 配置冲突问题

- 问题：Nginx默认配置与自定义配置冲突
- 解决方案：禁用Nginx默认配置，只启用自定义配置

### 部署状态

- 前端静态文件已成功构建
- Nginx配置文件已创建
- 后端服务配置文件已创建
- 部署脚本已编写完成
- 前端API调用问题已修复

### 部署访问地址

- 虚拟机IP：http://192.168.1.5
- 前端访问地址：http://192.168.1.5
- 后端API访问地址：http://192.168.1.5/api
- 游戏页面访问地址：http://192.168.1.5/multi-mode-game

### 技术亮点

1. **前后端分离部署**：通过Nginx实现了前后端分离部署，前端静态资源直接由Nginx提供服务，API请求通过Nginx代理到后端

2. **WebSocket代理**：配置了专门的WebSocket代理，确保实时通信功能正常工作

3. **系统服务管理**：使用systemd管理后端服务，确保服务稳定运行并支持开机自启

4. **完整的部署文档**：编写了详细的部署配置文件和脚本，便于在不同环境中快速部署

5. **优化的资源管理**：配置了静态资源缓存，提高了前端页面加载速度

## 后续计划

1. 在Linux虚拟机上实际部署并验证
2. 配置HTTPS支持
3. 实现自动化部署脚本
4. 添加监控和日志收集
5. 优化部署架构，支持负载均衡



