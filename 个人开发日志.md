# 个人开发日志

## 2025-12-14

### 后端开发

#### 1. 项目初始化与依赖配置
- 创建了Spring Boot 3项目
- 添加了JWT和密码加密依赖
- 配置了MySQL数据库连接

#### 2. 核心代码开发
- 创建了`User`实体类，包含id、username、password、isAdmin字段
- 实现了`UserRepository`接口，用于数据库操作
- 创建了`JwtUtil`工具类，用于生成和验证JWT令牌
- 创建了`PasswordEncoderUtil`工具类，使用BCrypt加密密码

#### 3. 控制器开发
- 实现了`AuthController`，包含：
  - 注册接口：`POST /api/auth/register`
  - 登录接口：`POST /api/auth/login`
- 配置了CORS，允许前端跨域请求

#### 4. 安全配置
- 实现了`SecurityConfig`，配置了：
  - JWT认证
  - 权限控制
  - CORS配置
  - 允许匿名访问的端点

### 前端开发

#### 1. 项目初始化
- 检查了前端项目结构
- 安装了axios依赖

#### 2. API服务封装
- 创建了`api.ts`，配置了axios实例
- 实现了请求拦截器和响应拦截器
- 封装了认证相关API

## 2025-12-15

### 后端开发

#### 1. 健康检查端点
- 添加了`HealthController`，提供`/api/health`端点
- 用于前端测试后端连接

#### 2. 配置更新
- 更新了CORS配置，将允许的源地址从5174改为5173
- 更新了安全配置，允许`/api/health`匿名访问

### 前端开发

#### 1. 清理与重构
- 清理了现有代码，保留核心文件
- 简化了`App.vue`和`main.ts`
- 配置了基础路由

#### 2. 登录注册组件
- 创建了`LoginView.vue`登录组件：
  - 用户名密码输入
  - 登录逻辑实现
  - 错误处理
  - 注册链接

- 创建了`RegisterView.vue`注册组件：
  - 用户名密码输入
  - 注册逻辑实现
  - 表单验证
  - 登录链接

#### 3. 路由配置
- 更新了路由配置，添加了登录和注册路由
- 将根路径`/`重定向到`/login`
- 保留`/home`作为登录后的首页

#### 4. API服务更新
- 添加了登录和注册请求方法
- 配置了请求拦截器，自动携带JWT令牌

## 2025-12-16

### 后端开发

#### 1. API扩展
- 添加了批量导入历史人物的API端点`POST /api/historical-persons/batch`
- 添加了更新历史人物的API端点`PUT /api/historical-persons/{id}`
- 扩展了`HistoricalPersonService`，添加了`batchAddHistoricalPersons`方法

#### 2. 数据库操作优化
- 使用JPA的`saveAll`方法实现高效批量插入
- 利用save方法的特性，根据ID判断是新增还是更新

### 前端开发

#### 1. 管理员功能
- 实现了历史人物的编辑功能，采用悬浮窗形式
- 添加了批量导入功能，支持JSON文件导入
- 实现了完整的分页功能，包括：
  - 上一页/下一页导航
  - 每页显示数量调整
  - 页码跳转
  - 记录范围显示

#### 2. 编辑悬浮窗
- 将编辑表单改为悬浮窗模态框
- 点击遮罩层或关闭按钮可关闭
- 支持键盘ESC关闭
- 表单居中显示，提升用户体验

#### 3. 分页功能
- 实现了前端分页逻辑，支持大数据量展示
- 实时更新分页状态和记录范围
- 调整每页显示数量后自动重置到第一页

#### 4. 样式优化
- 统一了表单样式
- 优化了模态框设计
- 添加了动画效果
- 响应式布局适配

### 其他工作

#### 1. 文件处理
- 尝试修复`2.json`文件的乱码问题
- 编写了编码转换脚本

#### 2. 功能测试
- 测试了编辑悬浮窗功能
- 验证了分页功能
- 测试了批量导入功能

#### 3. 代码优化
- 统一了组件命名规范
- 优化了状态管理
- 改进了错误处理

## 遇到的问题及解决方案

### 后端问题

1. **JWT工具类API更新问题**
   - 问题：JJWT 0.12.x版本API变化，导致`parseClaimsJws`方法调用失败
   - 解决方案：更新JWT工具类，使用新的API格式

2. **CORS配置问题**
   - 问题：前端端口变化，导致跨域请求失败
   - 解决方案：更新后端CORS配置，匹配前端实际端口

### 前端问题

1. **路由重定向循环**
   - 问题：登录成功后跳转到`/`，但`/`已重定向到`/login`，导致无限循环
   - 解决方案：将登录成功跳转路径改为`/home`

2. **vue-router导入错误**
   - 问题：`RouteRecordRaw`不再作为命名导出提供
   - 解决方案：移除类型导入，使用隐式类型推断

3. **浏览器扩展错误**
   - 问题：CSS Peeper扩展导致控制台报错
   - 解决方案：确认不是应用代码问题，建议更新或禁用扩展

## 项目状态

### 后端
- 核心功能已实现
- 登录注册接口正常
- 健康检查端点正常
- CORS和Security配置正确

### 前端
- 登录注册界面已实现
- 路由配置完成
- API服务已配置
- 能正常与后端通信

### 前后端联调
- 已完成基础联调
- 登录注册功能正常
- JWT令牌能正常生成和验证
- 跨域请求正常

## 后续计划

1. 完善首页功能
2. 添加更多业务功能
3. 优化用户体验
4. 添加更完善的错误处理
5. 实现用户信息管理

## 技术栈

### 后端
- Spring Boot 3
- Spring Data JPA
- MySQL
- JWT
- Spring Security
- BCrypt密码加密

### 前端
- Vue 3
- TypeScript
- Vue Router
- Axios
- Vite

## 访问地址

- 前端：http://localhost:5173
- 后端API：http://localhost:8080/api
- 登录页面：http://localhost:5173/login
- 注册页面：http://localhost:5173/register
- 首页：http://localhost:5173/home