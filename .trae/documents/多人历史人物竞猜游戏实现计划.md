# 多人历史人物竞猜游戏实现计划

## 一、需求分析

根据用户需求，我们需要在现有多人模式基础上实现以下功能：

1. 限定每个玩家的猜测次数
2. 创建房间时生成房间号供其他玩家加入
3. 当一名玩家猜出人物并胜利时，所有玩家显示游戏结束、胜利玩家和答案
4. 当所有玩家都选择投降或所有玩家次数耗尽时，所有玩家显示游戏结束和答案
5. 游戏开始由房主操控

## 二、技术架构

* **前端**：Vue 3 + TypeScript + WebSocket

* **后端**：Spring Boot + WebSocket + JPA

## 三、实现方案

### 1. 后端修改

#### 1.1 GameRoomService.java

* **PlayerInfo类扩展**：

  * 添加`guessCount`字段，记录玩家猜测次数

  * 添加`hasSurrendered`字段，标记玩家是否投降

* **RoomState类扩展**：

  * 添加`maxGuessCount`字段，设置最大猜测次数（默认10次，可以由房主设置）

  * 添加`targetPerson`字段的完整暴露逻辑

* **方法扩展**：

  * 添加`surrender`方法，处理玩家投降

  * 添加`checkGameEnd`方法，检查游戏是否结束

  * 修改`startGame`方法，初始化玩家猜测次数

#### 1.2 WebSocketController.java

* **添加消息处理**：

  * 添加`/game/surrender`消息映射，处理玩家投降

  * 修改`handleGuess`方法，实现猜测次数限制和游戏结束检查

  * 完善`GUESS_RESULT`消息，包含更多游戏状态信息

### 2. 前端修改

#### 2.1 MultiModeGame.vue

* **UI组件添加**：

  * 添加猜测次数显示

  * 添加投降按钮

  * 完善游戏结束画面

* **逻辑处理**：

  * 实现投降功能

  * 处理游戏结束的各种情况

  * 显示玩家排名和分数

#### 2.2 gameService.ts

* **方法扩展**：

  * 添加`surrender`方法，发送投降消息

  * 完善消息处理逻辑

## 四、核心流程

### 1. 游戏开始流程

1. 房主创建房间，生成房间号
2. 其他玩家通过房间号加入
3. 房主点击开始游戏
4. 后端随机选择目标人物，设置游戏状态为激活
5. 广播游戏开始消息给所有玩家

### 2. 猜测流程

1. 玩家输入历史人物名称进行猜测
2. 前端发送`/app/game/guess`消息
3. 后端检查猜测是否正确：

   * 正确：设置游戏结束，广播胜利消息

   * 错误：增加猜测次数，检查是否次数耗尽
4. 广播猜测结果给所有玩家

### 3. 投降流程

1. 玩家点击投降按钮
2. 前端发送`/app/game/surrender`消息
3. 后端标记玩家为投降状态
4. 检查是否所有玩家都已投降
5. 若所有玩家投降，广播游戏结束消息

### 4. 游戏结束检查

* 当任意玩家猜对时

* 当所有玩家都已投降时

* 当所有玩家的猜测次数都已耗尽时

## 五、实现步骤

1. 修改后端GameRoomService.java，扩展PlayerInfo和RoomState类
2. 修改后端WebSocketController.java，添加投降处理和游戏结束检查
3. 修改前端gameService.ts，添加投降方法
4. 修改前端MultiModeGame.vue，添加UI组件和逻辑处理
5. 测试所有功能，确保正常运行

## 六、预期效果

1. 玩家可以通过房间号加入游戏
2. 每个玩家有10次猜测机会
3. 玩家可以选择投降
4. 游戏结束时显示胜利玩家和答案
5. 支持多种游戏结束条件

## 七、技术要点

* WebSocket实时通信

* 游戏状态管理

* 消息广播机制

* 前端状态同步

通过以上实现，我们将完成一个功能完整、交互流畅的多人历史人物竞猜游戏。
